<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MELLMEMS — мемы Мелстроя</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@400;700;900&family=Russo+One&display=swap');

        :root {
            --neon-pink: #ff00c8;
            --neon-green: #00ff80;
            --neon-blue: #00ffff;
            --neon-purple: #bf00ff;
            --dark-bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --accent: #2a2a2a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Russo One', sans-serif;
            background:
            radial-gradient(circle at 20% 80%, rgba(255, 0, 200, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(0, 255, 128, 0.1) 0%, transparent 50%),
            linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background:
            radial-gradient(circle at 20% 80%, rgba(255, 0, 200, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(0, 255, 128, 0.08) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--neon-pink);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        header {
            background: linear-gradient(135deg,
            rgba(255, 0, 200, 0.9) 0%,
            rgba(0, 255, 128, 0.9) 100%);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 0, 200, 0.3);
            border-bottom: 3px solid var(--neon-green);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            font-weight: 900;
            margin: 0;
            background: linear-gradient(45deg, #fff, var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            font-family: 'Bangers', cursive;
            font-size: 1.8rem;
            margin-top: 10px;
            color: #fff;
            letter-spacing: 2px;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Russo One', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            box-shadow:
            0 0 20px rgba(255, 0, 200, 0.3),
            inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow:
            0 10px 30px rgba(255, 0, 200, 0.5),
            0 0 40px rgba(0, 255, 128, 0.3);
            background: linear-gradient(135deg, var(--neon-green), var(--neon-blue));
        }

        .quote {
            background: linear-gradient(135deg,
            rgba(255, 0, 200, 0.1) 0%,
            rgba(0, 255, 128, 0.1) 100%);
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-green)) 1;
            padding: 25px;
            margin: 30px auto;
            max-width: 800px;
            border-radius: 20px;
            text-align: center;
            font-size: 1.4rem;
            font-family: 'Bangers', cursive;
            color: var(--neon-green);
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .quote::before, .quote::after {
            content: '"';
            font-size: 3rem;
            color: var(--neon-pink);
            position: absolute;
            top: 10px;
        }

        .quote::before { left: 20px; }
        .quote::after { right: 20px; }

        main {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h2 {
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            margin: 40px 0 30px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-green));
            border-radius: 2px;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .empty-gallery {
            text-align: center;
            padding: 60px 20px;
            color: var(--neon-green);
            font-size: 1.4rem;
            grid-column: 1 / -1;
        }

        .empty-gallery .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .meme {
            background: linear-gradient(135deg, var(--card-bg), var(--accent));
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), transparent, var(--neon-green)) 1;
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
            box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .meme::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-green));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .meme:hover::before {
            transform: scaleX(1);
        }

        .meme:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow:
            0 20px 50px rgba(255, 0, 200, 0.2),
            0 0 60px rgba(0, 255, 128, 0.1);
        }

        .meme-content {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        .meme:hover .meme-content {
            transform: scale(1.05);
        }

        .meme .body {
            padding: 20px;
            text-align: center;
        }

        .meme h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #fff;
        }

        .like-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .like-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255, 0, 200, 0.3);
            color: #fff;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Russo One', sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .like-btn:hover:not(.liked):not(:disabled) {
            background: rgba(255, 0, 200, 0.2);
            border-color: var(--neon-pink);
            box-shadow: 0 0 20px rgba(255, 0, 200, 0.3);
        }

        .like-btn.liked {
            background: var(--neon-green);
            color: #000;
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.5);
        }

        .like-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .comment-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            color: #fff;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Russo One', sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .comment-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .media-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-green)) 1;
            color: #fff;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            z-index: 2;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-item {
            background: linear-gradient(135deg, var(--card-bg), var(--accent));
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-green)) 1;
            padding: 25px 35px;
            border-radius: 20px;
            text-align: center;
            min-width: 150px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            color: var(--neon-green);
            display: block;
            font-family: 'Orbitron', sans-serif;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--neon-blue);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .add-section, .game-section, .comments-section {
            background: linear-gradient(135deg, var(--card-bg), var(--accent));
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-green)) 1;
            border-radius: 25px;
            padding: 30px;
            margin: 40px auto;
            max-width: 900px;
            backdrop-filter: blur(10px);
            box-shadow:
            0 15px 40px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .add-section::before, .game-section::before, .comments-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-green), var(--neon-blue));
        }

        .upload-area {
            border: 3px dashed rgba(255, 0, 200, 0.5);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            margin: 20px 0;
        }

        .upload-area:hover {
            border-color: var(--neon-green);
            background: rgba(0,255,128,0.1);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.2);
        }

        .upload-area.dragover {
            border-color: var(--neon-pink);
            background: rgba(255,0,200,0.1);
            transform: scale(1.02);
        }

        input[type="text"], input[type="url"], select, input[type="file"] {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255, 0, 200, 0.3);
            border-radius: 12px;
            padding: 15px;
            color: white;
            font-family: 'Russo One', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            width: 100%;
            margin: 8px 0;
        }

        input[type="text"]:focus, input[type="url"]:focus, select:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.3);
            outline: none;
        }

        input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .file-info {
            margin: 15px 0;
            font-size: 1rem;
            color: var(--neon-blue);
        }

        .quality-warning {
            color: var(--neon-pink);
            font-size: 0.9rem;
            margin: 10px 0;
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            height: 8px;
            margin: 15px 0;
        }

        .progress {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-green));
            height: 100%;
            transition: width 0.4s ease;
        }

        .comments-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .empty-comments {
            text-align: center;
            padding: 40px 20px;
            color: var(--neon-blue);
            font-size: 1.2rem;
        }

        .empty-comments .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .comment {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid var(--neon-pink);
            backdrop-filter: blur(10px);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: bold;
            color: var(--neon-green);
        }

        .comment-date {
            font-size: 0.8rem;
            color: var(--neon-blue);
        }

        .comment-text {
            margin: 0;
            line-height: 1.4;
            color: #fff;
        }

        .add-comment {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #commentInput {
            flex: 1;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .game-stat {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid rgba(255, 0, 200, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .game-media {
            max-width: 400px;
            max-height: 250px;
            border-radius: 15px;
            margin: 20px auto;
            border: 3px solid var(--neon-pink);
            box-shadow: 0 0 30px rgba(255, 0, 200, 0.3);
            display: block;
        }

        .game-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .game-input {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: 3px solid rgba(255, 0, 200, 0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-family: 'Russo One', sans-serif;
            font-size: 1.1rem;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .game-input:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.3);
            outline: none;
        }

        .game-input.correct {
            border-color: var(--neon-green);
            background: rgba(0,255,128,0.1);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.5);
        }

        .game-input.wrong {
            border-color: #ff4444;
            background: rgba(255,0,0,0.1);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
        }

        .game-hint {
            color: var(--neon-blue);
            font-size: 1rem;
            margin: 10px 0;
            text-align: center;
        }

        .game-result {
            margin: 20px 0;
            font-size: 1.3rem;
            min-height: 40px;
            text-align: center;
            font-family: 'Bangers', cursive;
        }

        .game-correct {
            color: var(--neon-green);
        }

        .game-wrong {
            color: #ff4444;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            max-width: 95%;
            max-height: 95%;
            border-radius: 20px;
            box-shadow:
            0 0 80px rgba(255, 0, 200, 0.5),
            0 0 120px rgba(0, 255, 128, 0.3);
            border: 3px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-green)) 1;
        }

        .modal img.modal-content {
            object-fit: contain;
        }

        .modal video.modal-content {
            background: #000;
        }

        .close-modal {
            position: absolute;
            top: 30px;
            right: 30px;
            background: var(--neon-pink);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.5rem;
            font-family: 'Russo One', sans-serif;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 0, 200, 0.5);
        }

        .close-modal:hover {
            background: var(--neon-green);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.5);
        }

        .modal-audio-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 2px solid var(--neon-green);
        }

        .audio-btn {
            background: var(--neon-green);
            color: black;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Russo One', sans-serif;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.5);
        }

        .audio-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.7);
        }

        footer {
            background: linear-gradient(135deg, var(--card-bg), var(--accent));
            border-top: 3px solid;
            border-image: linear-gradient(90deg, var(--neon-pink), var(--neon-green)) 1;
            padding: 40px;
            margin-top: 60px;
            text-align: center;
            color: var(--neon-green);
            font-family: 'Russo One', sans-serif;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            h2 { font-size: 2rem; }
            .header-subtitle { font-size: 1.3rem; }
            .gallery { grid-template-columns: 1fr; }
            .controls { gap: 10px; }
            .btn { padding: 12px 20px; font-size: 0.9rem; }
            .stats { gap: 15px; }
            .stat-item { padding: 20px 25px; min-width: 120px; }
            .stat-number { font-size: 2rem; }
            .add-comment { flex-direction: column; }
            .game-media { max-width: 300px; max-height: 200px; }
            .game-stats { gap: 10px; }
            .game-stat { padding: 12px 20px; }
        }

        .tournament-section {
            background: linear-gradient(135deg, var(--card-bg), var(--accent));
            border: 2px solid;
            border-image: linear-gradient(45deg, #FFD700, #FFA500) 1;
            border-radius: 25px;
            padding: 30px;
            margin: 40px auto;
            max-width: 1000px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .tournament-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FFD700, #FFA500, #FF8C00);
        }

        .tournament-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tournament-bracket {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
        }

        .meme-competitor {
            text-align: center;
        }

        .tournament-card {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.1));
            border: 2px solid;
            border-image: linear-gradient(45deg, #FFD700, transparent, #FFA500) 1;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tournament-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255,215,0,0.3);
            border-image: linear-gradient(45deg, #FFD700, #FFA500) 1;
        }

        .tournament-card.selected {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
            box-shadow: 0 0 40px rgba(255,215,0,0.5);
            border-image: linear-gradient(45deg, #00ff80, #FFD700) 1;
        }

        .tournament-media-container {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .tournament-media-container img,
        .tournament-media-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .tournament-info h3 {
            color: #FFD700;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .meme-stats {
            color: var(--neon-green);
            font-size: 0.9rem;
        }

        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vs-text {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            padding: 15px 20px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2rem;
            font-family: 'Bangers', cursive;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .tournament-vote-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            margin-top: 10px;
        }

        .tournament-vote-btn:hover {
            background: linear-gradient(135deg, #00ff80, #00ffff);
            color: #000;
        }

        .tournament-result {
            text-align: center;
            margin: 20px 0;
            min-height: 40px;
            font-family: 'Bangers', cursive;
            font-size: 1.3rem;
        }

        .tournament-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tournament-winner {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.1));
            border-radius: 20px;
            border: 3px solid #FFD700;
        }

        .tournament-winner h3 {
            color: #FFD700;
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        .winner-card {
            max-width: 400px;
            margin: 0 auto;
        }

        .winner-card .tournament-media-container {
            height: 250px;
        }

        .winner-card .tournament-info h3 {
            font-size: 1.5rem;
            color: var(--neon-green);
        }

        @media (max-width: 768px) {
            .tournament-bracket {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 15px;
            }

            .vs-divider {
                order: 2;
            }

            .meme-competitor:first-child {
                order: 1;
            }

            .meme-competitor:last-child {
                order: 3;
            }

            .tournament-media-container {
                height: 150px;
            }
        }
    </style>
</head>
<body>
<div class="bg-animation"></div>
<div class="particles" id="particles"></div>

<header>
    <h1>🔥 MELLMEMS 🔥</h1>
    <p>mellstroy.game</p>
    <div class="header-subtitle">ВСЕЛЕННАЯ МЕМОВ</div>

    <div class="controls">
        <button class="btn" id="randomQuoteBtn">🎯 ЦИТАТА ДНЯ</button>
        <button class="btn" id="randomMemeBtn">🎲 СЛУЧАЙНЫЙ МЕМ</button>
        <button class="btn" id="statsBtn">📊 СТАТИСТИКА</button>
        <button class="btn" id="gameBtn">🎮 УГАДАЙ МЕМ</button>
        <button class="btn" id="tournamentBtn">🏆 ЛУЧШИЙ МЕМ</button>
        <button class="btn" id="clearStorageBtn">🧹 ОЧИСТИТЬ</button>
    </div>
</header>

<div class="quote" id="quoteBox">"Я не токсик — я контент!"</div>

<main>
    <div class="stats" id="statsSection" style="display: none;">
        <div class="stat-item">
            <span class="stat-number" id="totalMemes">0</span>
            <div class="stat-label">Всего мемов</div>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="totalLikes">0</span>
            <div class="stat-label">Всего лайков</div>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="topMemeLikes">0</span>
            <div class="stat-label">Рекорд лайков</div>
        </div>
    </div>

    <section class="game-section" id="gameSection" style="display: none;">
        <h2>🎮 УГАДАЙ НАЗВАНИЕ МЕМА</h2>
        <div class="game-stats">
            <div class="game-stat">Очки: <span id="gameScore">0</span></div>
            <div class="game-stat">Рекорд: <span id="gameHighScore">0</span></div>
            <div class="game-stat">Верно: <span id="gameCorrect">0</span>/<span id="gameTotal">0</span></div>
        </div>

        <div id="gameMediaContainer"></div>

        <input type="text" id="gameInput" class="game-input" placeholder="Введите название мема..." />
        <div class="game-hint">Напиши точное название мема и нажми Enter</div>

        <div class="game-result" id="gameResult"></div>

        <button class="btn" id="checkAnswerBtn">✅ Проверить</button>
        <button class="btn" id="nextGameBtn" style="display: none;">➡️ Следующий мем</button>
        <button class="btn" id="startGameBtn">🎯 Начать игру</button>
    </section>

    <section class="tournament-section" id="tournamentSection" style="display: none;">
        <h2>🏆 ТУРНИР ЛУЧШИХ МЕМОВ</h2>

        <div class="tournament-stats">
            <div class="game-stat">Раунд: <span id="tournamentRound">1</span>/<span id="totalRounds">0</span></div>
            <div class="game-stat">Осталось: <span id="memesLeft">0</span> мемов</div>
            <div class="game-stat">Победителей: <span id="winnersCount">0</span></div>
        </div>

        <div class="tournament-bracket">
            <div class="meme-competitor" id="meme1">
                <div class="meme-card tournament-card">
                    <div class="tournament-media-container" id="media1"></div>
                    <div class="tournament-info">
                        <h3 id="title1">Мем 1</h3>
                        <div class="meme-stats">
                            <span>👍 <span id="likes1">0</span></span>
                        </div>
                    </div>
                </div>
                <button class="btn tournament-vote-btn" data-meme="1">✅ ВЫБРАТЬ</button>
            </div>

            <div class="vs-divider">
                <div class="vs-text">VS</div>
            </div>

            <div class="meme-competitor" id="meme2">
                <div class="meme-card tournament-card">
                    <div class="tournament-media-container" id="media2"></div>
                    <div class="tournament-info">
                        <h3 id="title2">Мем 2</h3>
                        <div class="meme-stats">
                            <span>👍 <span id="likes2">0</span></span>
                        </div>
                    </div>
                </div>
                <button class="btn tournament-vote-btn" data-meme="2">✅ ВЫБРАТЬ</button>
            </div>
        </div>

        <div class="tournament-result" id="tournamentResult"></div>

        <div class="tournament-controls">
            <button class="btn" id="startTournamentBtn">🎯 НАЧАТЬ ТУРНИР</button>
            <button class="btn" id="nextTournamentRoundBtn" style="display: none;">➡️ СЛЕДУЮЩАЯ ПАРА</button>
            <button class="btn" id="finishTournamentBtn" style="display: none;">🏁 ЗАВЕРШИТЬ ТУРНИР</button>
        </div>

        <div class="tournament-winner" id="tournamentWinner" style="display: none;">
            <h3>🏆 ПОБЕДИТЕЛЬ ТУРНИРА! 🏆</h3>
            <div class="winner-card" id="winnerCard"></div>
        </div>
    </section>

    <h2>💥 ТОП МЕМЫ 💥</h2>
    <div class="gallery" id="gallery">
        <div class="empty-gallery">
            <span class="icon">🔄</span>
            <div>Пока нет мемов</div>
            <div style="font-size: 0.9rem; margin-top: 8px; opacity: 0.7;">Добавь первый мем через форму ниже!</div>
        </div>
    </div>

    <section class="comments-section" id="commentsSection" style="display: none;">
        <h2>💬 КОММЕНТАРИИ</h2>
        <div class="meme-title-display" id="currentMemeTitle" style="text-align: center; color: var(--neon-green); font-size: 1.3rem; margin-bottom: 20px;"></div>
        <div class="comments-container" id="commentsContainer">
            <div class="empty-comments">
                <span class="icon">💭</span>
                <div>Пока нет комментариев</div>
                <div style="font-size: 0.9rem; margin-top: 8px; opacity: 0.7;">Оставь первый комментарий!</div>
            </div>
        </div>
        <div class="add-comment">
            <input type="text" id="commentInput" placeholder="Напиши комментарий..." maxlength="200" />
            <button class="btn" id="addCommentBtn">💬 Отправить</button>
        </div>
    </section>

    <section class="add-section">
        <h2>🚀 ДОБАВЬ СВОЙ МЕМ</h2>

        <div class="upload-area" id="uploadArea">
            <div style="font-size: 1.5rem; margin-bottom: 15px;">📁 ПЕРЕТАЩИ ФАЙЛЫ СЮДА</div>
            <div style="margin-top: 15px;">
                <input type="file" id="fileInput" accept="image/*,video/*,audio/*" multiple />
            </div>
            <div class="file-info" id="fileInfo">Можно загружать картинки, видео и аудио</div>
            <div class="quality-warning">✅ Качество сохраняется оригинальное!</div>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress" id="progress"></div>
            </div>
        </div>

        <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:15px;margin-top:20px;">
            <input type="text" id="memeTitle" placeholder="Название мема" />
            <select id="memeType">
                <option value="image">🖼️ Картинка + звук</option>
                <option value="video">🎥 Видео</option>
            </select>
        </div>
        <div style="margin-top:20px;">
            <button class="btn" id="addMemeBtn">🎯 ДОБАВИТЬ МЕМ</button>
        </div>
    </section>
</main>

<div class="modal" id="mediaModal">
    <button class="close-modal" id="closeModal">✕</button>
    <img id="modalImage" class="modal-content" style="display: none;" />
    <video id="modalVideo" class="modal-content" controls style="display: none;"></video>
    <div class="modal-audio-controls" id="audioControls" style="display: none;">
        <button class="audio-btn" id="playAudioBtn">🔊 Воспроизвести звук</button>
    </div>
</div>

<footer>
    <div style="font-size: 1.2rem; margin-bottom: 10px;">© MELLMEMS</div>
    <div style="opacity: 0.8;">Только мемы, без хейта ❤️ Мемы Мелстроя</div>
</footer>

<script>
    const DEFAULT_QUOTES = [
        "Я не токсик — я контент!",
        "Главное — не проигрывать, а развлекать!",
        "Если не трэш, то не стрим.",
        "Контент делается болью и мемами.",
        "Пока другие отдыхают — я контентю!",
        "Это не хейт, это контент!",
        "Я не играю в игры, я делаю шоу!",
        "Трэш и угар — наше всё!",
        "Человек который не боится одиночества и которому интересно с самим собой, это сильный человек",
        "не жалейте в этой жизни ни о чём и никогда",
        "Шо ты лысый, плаки-плаки, нормалдаки",
        "Что за бизнес, с*ка?",
        "АМ АМ АМ АМ",
        "Я уже красный, культурно не получится на*уй",
        "Drake за миллион баксов подписался на меня",
        "Нет, на этого не стоит, но хайп того стоит",
        "Нельзя купить здоровье. Но его можно улучшить за деньги",
        "Настоящую любовь ты не купишь за бабки. Никогда в жизни"
    ];

    const DEFAULT_MEMES = [];

    const LS_MEMES = 'melverse_memes_v6';
    const LS_QUOTES = 'melverse_quotes_v1';
    const LS_COMMENTS = 'melverse_comments_v1';
    const LS_GAME_STATS = 'melverse_game_stats_v1';
    const LS_LIKED_MEMES = 'melverse_liked_memes_v1';
    const DB_NAME = 'MelverseDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'media';

    const gallery = document.getElementById('gallery');
    const quoteBox = document.getElementById('quoteBox');
    const randomQuoteBtn = document.getElementById('randomQuoteBtn');
    const randomMemeBtn = document.getElementById('randomMemeBtn');
    const statsBtn = document.getElementById('statsBtn');
    const gameBtn = document.getElementById('gameBtn');
    const addMemeBtn = document.getElementById('addMemeBtn');
    const clearStorageBtn = document.getElementById('clearStorageBtn');
    const mediaModal = document.getElementById('mediaModal');
    const modalImage = document.getElementById('modalImage');
    const modalVideo = document.getElementById('modalVideo');
    const closeModal = document.getElementById('closeModal');
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const statsSection = document.getElementById('statsSection');
    const playAudioBtn = document.getElementById('playAudioBtn');
    const audioControls = document.getElementById('audioControls');
    // Добавьте в раздел "Получаем элементы"
    const tournamentBtn = document.getElementById('tournamentBtn');
    const tournamentSection = document.getElementById('tournamentSection');
    const startTournamentBtn = document.getElementById('startTournamentBtn');
    const nextTournamentRoundBtn = document.getElementById('nextTournamentRoundBtn');
    const finishTournamentBtn = document.getElementById('finishTournamentBtn');
    const tournamentResult = document.getElementById('tournamentResult');
    const tournamentWinner = document.getElementById('tournamentWinner');
    const winnerCard = document.getElementById('winnerCard');

    let tournamentMemes = [];
    let currentRound = 1;
    let totalRounds = 0;
    let tournamentActive = false;

    function toggleTournament() {
        const isVisible = tournamentSection.style.display !== 'none';
        tournamentSection.style.display = isVisible ? 'none' : 'block';

        if (!isVisible) {
            resetTournament();
        }
    }

    function resetTournament() {
        tournamentMemes = [...memes];
        currentRound = 1;
        tournamentActive = false;
        tournamentWinner.style.display = 'none';
        tournamentResult.innerHTML = '';
        startTournamentBtn.style.display = 'inline-block';
        nextTournamentRoundBtn.style.display = 'none';
        finishTournamentBtn.style.display = 'none';

        updateTournamentStats();
    }

    function updateTournamentStats() {
        document.getElementById('tournamentRound').textContent = currentRound;
        document.getElementById('totalRounds').textContent = Math.ceil(Math.log2(tournamentMemes.length));
        document.getElementById('memesLeft').textContent = tournamentMemes.length;
        document.getElementById('winnersCount').textContent = 0;
    }

    async function startTournament() {
        if (tournamentMemes.length < 2) {
            alert('Нужно минимум 2 мема для турнира!');
            return;
        }

        tournamentActive = true;
        startTournamentBtn.style.display = 'none';
        nextTournamentRoundBtn.style.display = 'inline-block';

        tournamentMemes = shuffleArray([...tournamentMemes]);

        await nextTournamentRound();
    }

    async function nextTournamentRound() {
        if (!tournamentActive || tournamentMemes.length < 2) return;

        document.querySelectorAll('.tournament-card').forEach(card => {
            card.classList.remove('selected');
        });

        tournamentResult.innerHTML = '';

        const meme1 = tournamentMemes[0];
        const meme2 = tournamentMemes[1];

        updateTournamentStats();

        try {
            const media1 = await getFileFromDB(`${meme1.id}_media`);
            const mediaURL1 = createBlobURL(media1);
            await displayTournamentMeme(meme1, mediaURL1, 1);
            const media2 = await getFileFromDB(`${meme2.id}_media`);
            const mediaURL2 = createBlobURL(media2);
            await displayTournamentMeme(meme2, mediaURL2, 2);

        } catch (error) {
            console.error('Error loading tournament media:', error);
            tournamentResult.innerHTML = '<div style="color: #ff4444;">Ошибка загрузки медиа</div>';
        }
    }

    async function displayTournamentMeme(meme, mediaURL, number) {
        const mediaContainer = document.getElementById(`media${number}`);
        const titleElement = document.getElementById(`title${number}`);
        const likesElement = document.getElementById(`likes${number}`);

        titleElement.textContent = meme.title;
        likesElement.textContent = meme.likes || 0;

        mediaContainer.innerHTML = '';

        if (meme.type === 'video') {
            const video = document.createElement('video');
            video.src = mediaURL;
            video.controls = false;
            video.muted = true;
            video.autoplay = true;
            video.loop = true;
            video.style.width = '100%';
            video.style.height = '100%';
            video.style.objectFit = 'cover';
            mediaContainer.appendChild(video);
        } else {
            const img = document.createElement('img');
            img.src = mediaURL;
            img.alt = meme.title;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            mediaContainer.appendChild(img);
        }

        const voteBtn = document.querySelector(`.tournament-vote-btn[data-meme="${number}"]`);
        voteBtn.onclick = () => selectTournamentWinner(number);

        const card = document.getElementById(`meme${number}`).querySelector('.tournament-card');
        card.onclick = () => selectTournamentWinner(number);
    }

    function selectTournamentWinner(winnerNumber) {
        if (!tournamentActive) return;

        document.querySelectorAll('.tournament-card').forEach(card => {
            card.classList.remove('selected');
        });

        const selectedCard = document.getElementById(`meme${winnerNumber}`).querySelector('.tournament-card');
        selectedCard.classList.add('selected');

        const winner = tournamentMemes[winnerNumber - 1];
        const loser = tournamentMemes[winnerNumber === 1 ? 1 : 0];

        tournamentMemes = tournamentMemes.filter(meme => meme.id !== loser.id);

        tournamentResult.innerHTML = `
        <div style="color: var(--neon-green);">
            ✅ Выбран победитель: "<strong>${winner.title}</strong>"
        </div>
        <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
            Мемов осталось: ${tournamentMemes.length}
        </div>
    `;

        document.getElementById('memesLeft').textContent = tournamentMemes.length;
        document.getElementById('winnersCount').textContent = tournamentMemes.length;

        if (tournamentMemes.length === 1) {
            finishTournament();
        } else {
            nextTournamentRoundBtn.style.display = 'inline-block';
            finishTournamentBtn.style.display = 'inline-block';
        }
    }

    async function finishTournament() {
        if (tournamentMemes.length !== 1) {
            tournamentMemes = [tournamentMemes[0]]; 
        }

        const winner = tournamentMemes[0];
        tournamentActive = false;

        nextTournamentRoundBtn.style.display = 'none';
        finishTournamentBtn.style.display = 'none';

        try {
            const winnerMedia = await getFileFromDB(`${winner.id}_media`);
            const winnerMediaURL = createBlobURL(winnerMedia);

            winnerCard.innerHTML = `
            <div class="tournament-media-container">
                ${winner.type === 'video' ?
                    `<video src="${winnerMediaURL}" autoplay loop muted style="width:100%;height:100%;object-fit:cover;"></video>` :
                    `<img src="${winnerMediaURL}" alt="${winner.title}" style="width:100%;height:100%;object-fit:cover;">`
                }
            </div>
            <div class="tournament-info">
                <h3>${winner.title}</h3>
                <div class="meme-stats">
                    <span>👍 ${winner.likes || 0} лайков</span>
                </div>
            </div>
        `;

            tournamentWinner.style.display = 'block';
            tournamentResult.innerHTML = `
            <div style="color: #FFD700; font-size: 1.5rem;">
                🏆 ПОБЕДИТЕЛЬ ОПРЕДЕЛЕН! 🏆
            </div>
        `;


            tournamentWinner.scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            console.error('Error displaying winner:', error);
        }
    }

    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }


    tournamentBtn.addEventListener('click', toggleTournament);
    startTournamentBtn.addEventListener('click', startTournament);
    nextTournamentRoundBtn.addEventListener('click', nextTournamentRound);
    finishTournamentBtn.addEventListener('click', finishTournament);


    const commentsSection = document.getElementById('commentsSection');
    const commentsContainer = document.getElementById('commentsContainer');
    const commentInput = document.getElementById('commentInput');
    const addCommentBtn = document.getElementById('addCommentBtn');
    const currentMemeTitle = document.getElementById('currentMemeTitle');

    const gameSection = document.getElementById('gameSection');
    const gameMediaContainer = document.getElementById('gameMediaContainer');
    const gameInput = document.getElementById('gameInput');
    const gameResult = document.getElementById('gameResult');
    const gameScore = document.getElementById('gameScore');
    const gameHighScore = document.getElementById('gameHighScore');
    const gameCorrect = document.getElementById('gameCorrect');
    const gameTotal = document.getElementById('gameTotal');
    const startGameBtn = document.getElementById('startGameBtn');
    const nextGameBtn = document.getElementById('nextGameBtn');
    const checkAnswerBtn = document.getElementById('checkAnswerBtn');

    let uploadedMedia = null;
    let uploadedAudio = null;
    let currentAudio = null;
    let db = null;
    let memes = [];
    let quotes = [];
    let comments = {};
    let likedMemes = {};
    let currentMemeForComments = null;

    let gameStats = {
        score: 0,
        highScore: 0,
        correct: 0,
        total: 0
    };
    let currentGameMeme = null;
    let gameActive = false;

    function createParticles() {
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.top = Math.random() * 100 + 'vh';
            particle.style.animationDelay = Math.random() * 6 + 's';
            particle.style.background = i % 3 === 0 ? 'var(--neon-pink)' :
            i % 3 === 1 ? 'var(--neon-green)' : 'var(--neon-blue)';
            particlesContainer.appendChild(particle);
        }
    }

    function initDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                db = request.result;
                resolve(db);
            };

            request.onupgradeneeded = (event) => {
                const database = event.target.result;
                if (!database.objectStoreNames.contains(STORE_NAME)) {
                    const store = database.createObjectStore(STORE_NAME, { keyPath: 'id' });
                    store.createIndex('memeId', 'memeId', { unique: false });
                }
            };
        });
    }

    async function saveFileToDB(memeId, file, type) {
        return new Promise((resolve, reject) => {
            if (!db) {
                reject(new Error('Database not initialized'));
                return;
            }

            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);

            const fileData = {
                id: `${memeId}_${type}`,
                memeId: memeId,
                type: type,
                file: file,
                timestamp: Date.now()
            };

            const request = store.put(fileData);

            request.onsuccess = () => resolve(fileData.id);
            request.onerror = () => reject(request.error);
        });
    }

    async function getFileFromDB(fileId) {
        return new Promise((resolve, reject) => {
            if (!db) {
                reject(new Error('Database not initialized'));
                return;
            }

            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.get(fileId);

            request.onsuccess = () => {
                if (request.result) {
                    resolve(request.result.file);
                } else {
                    reject(new Error('File not found'));
                }
            };
            request.onerror = () => reject(request.error);
        });
    }

    function createBlobURL(file) {
        return URL.createObjectURL(file);
    }

    function revokeBlobURL(url) {
        if (url && url.startsWith('blob:')) {
            URL.revokeObjectURL(url);
        }
    }

    function saveToStorage(key, value){
        try {
            localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
            console.warn('Не удалось сохранить в localStorage', e);
        }
    }

    function loadFromStorage(key){
        try {
            const raw = localStorage.getItem(key);
            return raw ? JSON.parse(raw) : null;
        } catch (e) {
            console.warn('Не удалось прочитать localStorage', e);
            return null;
        }
    }

    function updateStats() {
        const totalMemes = memes.length;
        const totalLikes = memes.reduce((sum, meme) => sum + (meme.likes || 0), 0);
        const topMemeLikes = memes.length > 0 ? Math.max(...memes.map(m => m.likes || 0)) : 0;

        document.getElementById('totalMemes').textContent = totalMemes;
        document.getElementById('totalLikes').textContent = totalLikes;
        document.getElementById('topMemeLikes').textContent = topMemeLikes;
    }

    function toggleStats() {
        const isVisible = statsSection.style.display !== 'none';
        statsSection.style.display = isVisible ? 'none' : 'flex';
        updateStats();
    }

    async function openMediaModal(meme) {
        modalImage.style.display = 'none';
        modalVideo.style.display = 'none';
        audioControls.style.display = 'none';

        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }

        try {
            if (meme.type === 'video') {
                const videoFile = await getFileFromDB(`${meme.id}_media`);
                const videoURL = createBlobURL(videoFile);
                modalVideo.src = videoURL;
                modalVideo.style.display = 'block';
            } else {
                const imageFile = await getFileFromDB(`${meme.id}_media`);
                const imageURL = createBlobURL(imageFile);
                modalImage.src = imageURL;
                modalImage.style.display = 'block';

                if (meme.audioId) {
                    audioControls.style.display = 'flex';
                    playAudioBtn.onclick = async () => {
                        const audioFile = await getFileFromDB(meme.audioId);
                        playAudio(audioFile);
                    };
                }
            }

            mediaModal.style.display = 'flex';
        } catch (error) {
            console.error('Error opening media:', error);
            alert('Ошибка при загрузке медиа');
        }
    }

    function handleFileSelect(files) {
        uploadedMedia = null;
        uploadedAudio = null;

        const mediaFiles = [];
        const audioFiles = [];

        Array.from(files).forEach(file => {
            if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
                mediaFiles.push(file);
            } else if (file.type.startsWith('audio/')) {
                audioFiles.push(file);
            }
        });

        if (mediaFiles.length > 0) {
            uploadedMedia = mediaFiles[0];
            fileInfo.textContent = `📁 Медиа: ${uploadedMedia.name} (${formatFileSize(uploadedMedia.size)})`;

            if (mediaFiles.length > 1 && mediaFiles[1].type.startsWith('audio/')) {
                uploadedAudio = mediaFiles[1];
                fileInfo.textContent += ` | 🔊 Аудио: ${uploadedAudio.name}`;
            }
        }

        if (audioFiles.length > 0 && !uploadedAudio) {
            uploadedAudio = audioFiles[0];
            fileInfo.textContent += ` | 🔊 Аудио: ${uploadedAudio.name}`;
        }

        if (files.length === 0) {
            fileInfo.textContent = 'Можно загружать картинки, видео и аудио';
        }
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        handleFileSelect(files);
    });

    fileInput.addEventListener('change', (e) => {
        handleFileSelect(e.target.files);
    });

    function playAudio(audioFile) {
        if (!audioFile) return;

        if (currentAudio) {
            currentAudio.pause();
        }

        const audioURL = createBlobURL(audioFile);
        currentAudio = new Audio(audioURL);
        currentAudio.play().catch(e => {
            console.log('Не удалось воспроизвести звук:', e);
        });
    }

    async function renderMemes(){
        gallery.innerHTML = '';

        if (memes.length === 0) {
            gallery.innerHTML = `
          <div class="empty-gallery">
            <span class="icon">🔄</span>
            <div>Пока нет мемов</div>
            <div style="font-size: 0.9rem; margin-top: 8px; opacity: 0.7;">Добавь первый мем через форму ниже!</div>
          </div>
        `;
            return;
        }

        const sorted = memes.slice().sort((a,b) => (b.likes || 0) - (a.likes || 0));

        for (const meme of sorted) {
            const card = document.createElement('article');
            card.className = 'meme';

            try {
                const mediaFile = await getFileFromDB(`${meme.id}_media`);
                const mediaURL = createBlobURL(mediaFile);

                let mediaContent = '';
                let indicator = '';

                if (meme.type === 'video') {
                    mediaContent = `<video class="meme-content" preload="metadata">
              <source src="${escapeHtmlAttr(mediaURL)}" type="${mediaFile.type}">
            </video>`;
                    indicator = `<div class="media-indicator video-indicator">🎥 ВИДЕО</div>`;
                } else {
                    mediaContent = `<img class="meme-content" src="${escapeHtmlAttr(mediaURL)}" alt="${escapeHtmlAttr(meme.title)}" loading="lazy">`;
                    if (meme.audioId) {
                        indicator = `<div class="media-indicator audio-indicator">🔊 ЗВУК</div>`;
                    }
                }

                const isLiked = likedMemes[meme.id] || false;
                const likeBtnClass = isLiked ? 'like-btn liked' : 'like-btn';
                const likeBtnDisabled = isLiked ? 'disabled' : '';

                card.innerHTML = `
            ${indicator}
            ${mediaContent}
            <div class="body">
              <h3>${escapeHtml(meme.title)}</h3>
              <div class="like-row">
                <button class="${likeBtnClass}" ${likeBtnDisabled} data-id="${meme.id}" aria-label="Нравится">
                  👍 <span class="likes-count">${meme.likes||0}</span>
                </button>
                <button class="comment-btn" data-id="${meme.id}" aria-label="Комментарии">💬</button>
              </div>
            </div>
          `;

                card.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('like-btn') && !e.target.classList.contains('comment-btn')) {
                        openMediaModal(meme);
                    }
                });

                const likeBtn = card.querySelector('.like-btn');
                likeBtn.addEventListener('click', function(e){
                    e.stopPropagation();
                    const foundIdx = memes.findIndex(m => m.id === meme.id);
                    if (foundIdx !== -1 && !likedMemes[meme.id]) {
                        likeMeme(foundIdx);
                    }
                });

                const commentBtn = card.querySelector('.comment-btn');
                commentBtn.addEventListener('click', function(e){
                    e.stopPropagation();
                    showComments(meme);
                });

                gallery.appendChild(card);
            } catch (error) {
                console.error('Error rendering meme:', error);
            }
        }

        updateStats();
    }

    function likeMeme(i){
        const meme = memes[i];

        if (likedMemes[meme.id]) {
            return;
        }

        meme.likes = (meme.likes || 0) + 1;
        likedMemes[meme.id] = true;

        saveToStorage(LS_MEMES, memes);
        saveToStorage(LS_LIKED_MEMES, likedMemes);

        renderMemes();
    }

    function randomQuote(){
        if (!quotes.length) return;
        const q = quotes[Math.floor(Math.random() * quotes.length)];
        quoteBox.textContent = `"${q}"`;
    }

    function randomMeme(){
        if (!memes.length) {
            alert('Пока нет мемов! Добавь первый мем через форму ниже.');
            return;
        }
        const idx = Math.floor(Math.random() * memes.length);

        const nodes = Array.from(gallery.children);
        if (nodes[idx]) {
            nodes[idx].scrollIntoView({ behavior: 'smooth', block: 'center' });
            nodes[idx].style.transition = 'box-shadow .3s ease, transform .3s ease';
            nodes[idx].style.boxShadow = '0 30px 60px rgba(0,255,128,0.3)';
            setTimeout(() => { nodes[idx].style.boxShadow = ''; }, 900);
        }
    }

    function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    async function addMeme(){
        const titleInput = document.getElementById('memeTitle');
        const typeInput = document.getElementById('memeType');

        const title = (titleInput.value || '').trim();
        const type = typeInput.value;

        if (!title) {
            alert('Введите название мема!');
            return;
        }

        if (!uploadedMedia) {
            alert('Загрузите медиа файл!');
            return;
        }

        progressBar.style.display = 'block';
        progress.style.width = '30%';

        try {
            const memeId = generateId();

            progress.style.width = '60%';
            await saveFileToDB(memeId, uploadedMedia, 'media');

            let audioId = null;
            if (uploadedAudio) {
                progress.style.width = '80%';
                audioId = await saveFileToDB(memeId, uploadedAudio, 'audio');
            }

            progress.style.width = '100%';

            const newMeme = {
                id: memeId,
                title,
                type: uploadedMedia.type.startsWith('video/') ? 'video' : 'image',
                audioId: audioId,
                likes: 0,
                createdAt: Date.now()
            };

            memes.unshift(newMeme);
            saveToStorage(LS_MEMES, memes);

            titleInput.value = '';
            fileInput.value = '';
            uploadedMedia = null;
            uploadedAudio = null;
            fileInfo.textContent = 'Можно загружать картинки, видео и аудио';
            progressBar.style.display = 'none';
            progress.style.width = '0%';

            await renderMemes();
            window.scrollTo({ top: 0, behavior: 'smooth' });

        } catch (error) {
            alert('Ошибка при загрузке файлов: ' + error.message);
            progressBar.style.display = 'none';
            progress.style.width = '0%';
        }
    }

    async function clearLocalData(){
        if (!confirm('Сбросить все мемы, лайки и комментарии?')) return;

        if (db) {
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            store.clear();
        }

        localStorage.removeItem(LS_MEMES);
        localStorage.removeItem(LS_QUOTES);
        localStorage.removeItem(LS_COMMENTS);
        localStorage.removeItem(LS_GAME_STATS);
        localStorage.removeItem(LS_LIKED_MEMES);

        memes = DEFAULT_MEMES.slice();
        quotes = DEFAULT_QUOTES.slice();
        comments = {};
        likedMemes = {};
        gameStats = { score: 0, highScore: 0, correct: 0, total: 0 };

        await renderMemes();
        randomQuote();
        updateGameStats();
    }

    function escapeHtml(str){
        if (!str) return '';
        return String(str)
            .replaceAll('&','&amp;')
            .replaceAll('<','&lt;')
            .replaceAll('>','&gt;')
            .replaceAll('"','&quot;')
            .replaceAll("'", '&#39;');
    }

    function escapeHtmlAttr(str){
        return escapeHtml(str).replaceAll('\n',' ');
    }
    
    function showComments(meme) {
        currentMemeForComments = meme;
        currentMemeTitle.textContent = meme.title;
        commentsSection.style.display = 'block';
        renderComments();

        commentsSection.scrollIntoView({ behavior: 'smooth' });
    }

    function renderComments() {
        if (!currentMemeForComments) return;

        const memeComments = comments[currentMemeForComments.id] || [];
        commentsContainer.innerHTML = '';

        if (memeComments.length === 0) {
            commentsContainer.innerHTML = `
          <div class="empty-comments">
            <span class="icon">💭</span>
            <div>Пока нет комментариев</div>
            <div style="font-size: 0.9rem; margin-top: 8px; opacity: 0.7;">Оставь первый комментарий!</div>
          </div>
        `;
            return;
        }

        memeComments.sort((a, b) => b.timestamp - a.timestamp);

        memeComments.forEach(comment => {
            const commentEl = document.createElement('div');
            commentEl.className = 'comment';
            commentEl.innerHTML = `
          <div class="comment-header">
            <span class="comment-author">${escapeHtml(comment.author)}</span>
            <span class="comment-date">${new Date(comment.timestamp).toLocaleString()}</span>
          </div>
          <p class="comment-text">${escapeHtml(comment.text)}</p>
        `;
            commentsContainer.appendChild(commentEl);
        });
    }

    function addComment() {
        if (!currentMemeForComments) return;

        const text = commentInput.value.trim();
        if (!text) {
            alert('Введите текст комментария!');
            return;
        }

        const comment = {
            id: generateId(),
            text: text,
            author: 'Анонимный зритель',
            timestamp: Date.now()
        };

        if (!comments[currentMemeForComments.id]) {
            comments[currentMemeForComments.id] = [];
        }

        comments[currentMemeForComments.id].push(comment);
        saveToStorage(LS_COMMENTS, comments);

        commentInput.value = '';
        renderComments();
    }

    function toggleGame() {
        const isVisible = gameSection.style.display !== 'none';
        gameSection.style.display = isVisible ? 'none' : 'block';

        if (!isVisible) {
            updateGameStats();
            gameActive = true;
            gameInput.disabled = false;
            gameInput.value = '';
            gameInput.classList.remove('correct', 'wrong');
            gameResult.innerHTML = '';
            startGameBtn.style.display = 'inline-block';
            nextGameBtn.style.display = 'none';
            checkAnswerBtn.style.display = 'none';
        }
    }

    function updateGameStats() {
        gameScore.textContent = gameStats.score;
        gameHighScore.textContent = gameStats.highScore;
        gameCorrect.textContent = gameStats.correct;
        gameTotal.textContent = gameStats.total;
    }

    async function startGame() {
        if (memes.length === 0) {
            alert('Нужно хотя бы один мем для игры!');
            return;
        }

        gameActive = true;
        startGameBtn.style.display = 'none';
        nextGameBtn.style.display = 'inline-block';
        checkAnswerBtn.style.display = 'inline-block';
        gameInput.disabled = false;
        gameInput.value = '';
        gameInput.classList.remove('correct', 'wrong');
        gameResult.innerHTML = '';

        await nextGameRound();
    }

    async function nextGameRound() {
        if (!gameActive) return;

        currentGameMeme = memes[Math.floor(Math.random() * memes.length)];

        gameMediaContainer.innerHTML = '';
        gameInput.value = '';
        gameInput.classList.remove('correct', 'wrong');
        gameResult.innerHTML = '';
        gameInput.disabled = false;
        gameInput.focus();

        try {
            const mediaFile = await getFileFromDB(`${currentGameMeme.id}_media`);
            const mediaURL = createBlobURL(mediaFile);

            if (currentGameMeme.type === 'video') {
                const video = document.createElement('video');
                video.className = 'game-media game-video';
                video.src = mediaURL;
                video.controls = false;
                video.muted = true;
                video.autoplay = true;
                video.loop = true;
                gameMediaContainer.appendChild(video);
            } else {
                const img = document.createElement('img');
                img.className = 'game-media';
                img.src = mediaURL;
                img.alt = 'Угадай мем';
                gameMediaContainer.appendChild(img);
            }

            gameStats.total++;
            updateGameStats();

        } catch (error) {
            console.error('Error loading game media:', error);
            gameResult.innerHTML = '<div class="game-wrong">Ошибка загрузки медиа</div>';
        }
    }

    function checkAnswer() {
        if (!currentGameMeme || !gameActive) return;

        const userAnswer = gameInput.value.trim().toLowerCase();
        const correctAnswer = currentGameMeme.title.toLowerCase();

        if (!userAnswer) {
            alert('Введите название мема!');
            return;
        }

        const isCorrect = userAnswer === correctAnswer;

        if (isCorrect) {
            gameInput.classList.add('correct');
            gameResult.innerHTML = '<div class="game-correct">✅ Верно! +10 очков</div>';
            gameStats.score += 10;
            gameStats.correct++;
        } else {
            gameInput.classList.add('wrong');
            gameResult.innerHTML = `<div class="game-wrong">❌ Неверно! Правильный ответ: "${currentGameMeme.title}"</div>`;
            gameStats.score = Math.max(0, gameStats.score - 5);
        }

        if (gameStats.score > gameStats.highScore) {
            gameStats.highScore = gameStats.score;
        }

        updateGameStats();
        saveToStorage(LS_GAME_STATS, gameStats);
    }

    randomQuoteBtn.addEventListener('click', randomQuote);
    randomMemeBtn.addEventListener('click', randomMeme);
    statsBtn.addEventListener('click', toggleStats);
    gameBtn.addEventListener('click', toggleGame);
    addMemeBtn.addEventListener('click', addMeme);
    clearStorageBtn.addEventListener('click', clearLocalData);

    addCommentBtn.addEventListener('click', addComment);
    commentInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') addComment();
    });


    startGameBtn.addEventListener('click', startGame);
    nextGameBtn.addEventListener('click', nextGameRound);
    checkAnswerBtn.addEventListener('click', checkAnswer);
    gameInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') checkAnswer();
    });


    closeModal.addEventListener('click', function() {
        mediaModal.style.display = 'none';
        modalVideo.pause();
        modalVideo.src = '';
        revokeBlobURL(modalImage.src);
        modalImage.src = '';
        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }
    });

    mediaModal.addEventListener('click', function(e) {
        if (e.target === mediaModal) {
            mediaModal.style.display = 'none';
            modalVideo.pause();
            modalVideo.src = '';
            revokeBlobURL(modalImage.src);
            modalImage.src = '';
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
        }
    });


    document.getElementById('memeTitle').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') addMeme();
    });

    async function init() {
        try {
            await initDB();
            quotes = loadFromStorage(LS_QUOTES) || DEFAULT_QUOTES.slice();
            memes = loadFromStorage(LS_MEMES) || DEFAULT_MEMES.slice();
            comments = loadFromStorage(LS_COMMENTS) || {};
            likedMemes = loadFromStorage(LS_LIKED_MEMES) || {};
            gameStats = loadFromStorage(LS_GAME_STATS) || { score: 0, highScore: 0, correct: 0, total: 0 };

            await renderMemes();
            randomQuote();
            updateGameStats();
            createParticles();
        } catch (error) {
            console.error('Initialization error:', error);
            alert('Ошибка инициализации приложения');
        }
    }


    init();
</script>
</body>
</html>
